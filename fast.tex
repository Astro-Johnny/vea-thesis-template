\section{FAST raksturpunktu noteikšanas algoritms} \label{sec:fast}
\setcounter{lstlisting}{0} %Reset listings counter (for the section)

\newcommand{\Ip}{I_{\vec{p}}}
\newcommand{\Ipc}{ {I_{\vec{p} \to c}} }
\newcommand{\Spc}{ {S_{\vec{p} \to c}} }

% TODO?: Nodaļas ievads?
\subsection{Definīcija} \label{sec:fast-def}
\subsubsection{Punktu klasifikācija}

\begin{figure}[tbh]
	\centering
	\includegraphics[width=0.7\textwidth]{fast-corner}
	\caption{FAST 16 pikseļu riņķa pārbaudes logs~\cite{FAST}.}
	\label{fig:fast}
\end{figure}

FAST ir Rostena~un~Dramonda\cite{FAST}~(\termEn{Rosten and Drummond})
izstrādāts stūru detektors, kurš tiek izmantots attēla potenciālo 
raksturpunktu noteikšanai~(sk.~\ref{sec:corners}~nod.).

FAST detektors kandidāta punkta $\vec{p}$ klasificēšanai, izmanto intensitāšu
salīdzināšanu starp punktu $\vec{p}$ un 16~pikseļu riņķi (\termEn{Bresenham} riņķis
ar rādiusu 3) ap punktu $\vec{p}$. 
FAST definīcija nosaka, ka apskatāmais punkts $\vec{p}$ ir uzskatāms par
,,stūri'' tad, ja $n$ skaita secīgi pikseļi ir, vai nu gaišāki
(ar augstāku intensitāte) par kandidāta pikseļa intensitāti $\Ip$, kuram
pieskaitīta sliekšņa vērtība $t$, vai tumšāki (ar zemāku intensitāte) par
$\Ip - t$. \cite{Rosten-tracking}\cite{FAST}

Katrs no riņķa punktiem, kurus apzīmēsim ar $\vec{p}\to c$, kur $c \in [1; 16]$,
var būt vienā no trīs stāvokļiem:
\begin{equation}\label{eq:fast}
	\Spc := \left\{
		\begin{array}{c} d\text{,}\\ s\text{,}\\ b\text{,} \end{array}
		\begin{aligned}
			           & \Ipc < \Ip-t \\
			\Ip-t \leq & \Ipc \leq \Ip+t \\
			   \Ip+t < & \Ipc
		\end{aligned}
		\right.
\end{equation}
kur $d$ un $b$ attiecīgi apzīmē ,,tumšāks'' vai ,,gaišāks'', un $s$ apzīmē
,,līdzīgs''. Tātad $n$ skaitam $\Spc$ vērtību ar secīgiem $c$ jābūt visiem
$b$ stāvoklī, vai visiem $d$ stāvoklī, lai $\vec{p}$ tiktu klasificēts kā
,,stūra'' punkts. Šajā pielietojumā visi atrastie ,,stūri'' tiek pieņemti
par attēla raksturpunktiem.

Uzdotā \eqref{eq:fast} definīcija ir autora koriģēta, jo ir novērota pretruna
Rostena un~Dramonda\cite{FAST} definīcijā pret visu apskatīto
FAST implementāciju (t.sk.~Rostena un Dramonda\cite{FAST} pašu implementācijas)
funkcionalitāti. Avotā \cite{FAST} stāvokļi $d$ un $b$ ir definēti ar
nestingrām nevienādībām, kaut gan visās implementācijās izmantota stingrā
salīdzināšana. Autors devis priekšroku implementāciju funkcionalitātei un
attiecīgi veicis korekcijas definīcijā.

Vienkāršākā šīs definīcijas algoritmiska implementācija ir, katram
punktam $\vec{p}$ secīgi pārbaudīt visus $c$ (nosakot $\Spc$)
līdz tiek konstatēti $n$ skaita punkti, kas atbilst iepriekšminētajam
kritērijam. Rostens~un~Dramonds\cite{FAST} šādu implementāciju sauc par
,,\emph{segmenta testu}''. Pilns segmenta tests ir uzskatāma par 
neefektīvu implementāciju~\cite{FAST},
un \ref{sec:fast-impl} nodaļā tiek apskatītas citi FAST implementāciju varianti.


\subsubsection{Lokālo maksimumu atlase}
FAST klasifikācijas rezultātā var rasties situācija, ka vairāki 
blakus esoši pikseļi tiek klasificēti kā raksturpunkti.
Raksturpunktu salāgošanai šī ir nevēlama situācija, jo šo punktu apkārtnes
ir līdzīgas un var radīt salāgošanas konfliktus.

Lai šo situāciju novērstu, izmanto lokālo maksimumu atlasi, kas lokalizētā
apkārtnē atstāj tikai punktu ar maksimālo vērtību, kā ilustrēts \ref{fig:nonmax}~attēlā.
Jāņem vērā, ka FAST
klasifikācija atgriež tikai bināru vērtību vai punkts ir ,,stūris'',
tādēļ nepieciešams piešķirt punktiem to kvantitatīvu ,,stūrainības'' mēru.

Lai gan \cite{FAST}~avotā ir definīcija, punktu vērtēšanai izmantojot
absolūto starpību summu, autors konstatē, ka publicētajā programmas pirmkodā%
\footnote{\url{http://www.edwardrosten.com/work/fast.html}}
neatbilst definīcijai.

%\begin{singlespace}
% NOTE: No Need for singlespace when floated!
	\lstinputlisting[language={C++},float=thb,%
	                 caption={,,Stūra'' punkta vērtēšanas funkcija (no CVD bibliotēkas).},%
	                 linerange={2915-2933},firstnumber=2915,%
	                 breaklines,breakatwhitespace,%
	                 label=kb:fast-score-cvd]
		{code/fast9.cc}
%\end{singlespace}

Pēc koda analīzes (sk.~\ref{kb:fast-score-cvd}~pirmkodu)
autors secina, ka punkti tiek vērtēti pēc sliekšņa $t$ vērtības
(pirmkodā mainīgais \texttt{b}), pie kuras
punkts joprojām atbilst ,,stūra'' kritērijam.

Formāli, ja FAST klasifikāciju uzdodam kā funkciju $F_n(\vec{p}, t)$,
kura ir patiesa, ja punkts $\vec{p}$ pie sliekšņa $t$ ir klasificējams
kā ,,stūris'', tad vērtības funkciju varam uzdot kā:
\begin{equation}
	V(\vec{p}) := \left\{ \max{t} : F_n(\vec{p}, t) \right\}
\end{equation}
Funkcionāli ekvivalenta realizācija izmantota visās apskatītajās FAST
implementācijās.

%~ Tika noskaidrots, ka FAST pirmkodā vērtēšanas funkcija izmainīta versijā~2.0,
%~ kas izlaista pēc \cite{FAST} avota publikācijas. Toties Rostena jaunākā
%~ publikācijā, jau aprakstīta izmainītā FAST punktu vērtēšana,
%~ bet nav minēts izmaiņas pamatojums~\cite{FASTER}.

\begin{figure}[tbh]
	\centering
	\def\svgwidth{0.8\linewidth}
	{\input{img/nonmax-suppression.pdf_tex}}
	\caption{Raksturpunktu klasifikācija un lokālo maksimumu atlase.}
	\label{fig:nonmax}
\end{figure}

Kad punkti ir klasificēti un rezultējošiem raksturpunktiem piekārtota
vērtība, tiek salīdzinātas vērtības blakusesošiem raksturpunktiem
jeb
noteikts lokālais maksimums $3 \times 3$ pikseļu logā katram
\phantomsection\label{sym:A}
$\vec{p} \in F_n(\vb{A}, t)$, kur $\vb{A}$ ir viss attēls.
Punkti, kuri nav lokālie maksimumi tiek atmesti no raksturpunktu kopas.

FAST lokālo maksimumu atlasei tiek izmantoti divi varianti:
\begin{itemize}
	\item ,,\emph{relaksētais}'', kurš pieļauj blakusesošus, ja to
		vērtības ir vienādas (maksimuma vērtība ir nestingri lielāka), un
	\item ,,\emph{striktais}'', kur maksimuma vērtībai jābūt stingri
		lielākai par apkārtnes punktu vērtībām, pretējā gadījumā abi (vai
		visi) šie raksturpunkti tiek atmesti.
\end{itemize}
No abiem variantiem, autors izvēlējās un darbā izmanto ,,strikto'' definīciju,
jo varbūtība blakusesošiem raksturpunktiem, ka tiem sakritīs to
\termTech{deskriptori} salāgošanai, radot konfliktu, ir ļoti augsta.
Pie tam, pat ja tā nav, tad pozīcijas nenoteiktības dēļ, raksturpunkti tik
un tā ir uzskatāmi par nekvalitatīviem un ir nevēlami iekļaušanai
raksturpunktu kopā.

\subsection{oFAST modifikācija} \label{sec:ofast}
\TODO

\subsection{Implementāciju modeļi} \label{sec:fast-impl}
\input{fast.original.tex}
\input{fast.opencv.tex}
\input{fast.fpga.tex}
\input{fast.comparison.tex}
%TODO?: Atmestie modeļi?

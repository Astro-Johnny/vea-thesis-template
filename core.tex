\section{Mikrokontroliera kodola realizācija} \label{sec:cpu}
	Mikrokontroliera kodols pēc savas būtības un uzbūves ir procesors,
	kurš veic kalkulācijas un datu apmaiņu, nodrošinot mikrokontroliera
	programmas izpildi.
	Šajā darbā izstrādātais mikrokontroliera kodols ir 
	Fon-Neimaņa (\termEn{von~Neumann}) arhitektūras pro\-ce\-sors, kurš
	izmanto 16 bitu instrukcijas%
		\footnote{Instrukcijas var būt $N$-skaita 16 bitu vārdi. 
		Šajā darbā realizētas viena un divu vārdu instrukcijas.}
	un 16 bitu atmiņas adreses. Arī atmiņas vienība, kurai pieder unikāla
	adrese, ir 16 bitu plata. Kā Fon-Neimaņa procesoram, datu un
	programmkoda atmiņa ir kopēja un vienādi adresējama.[\todo]
	
	Kodola uzbūve ir daļēji balstīta uz D.~Perija (\termEn{D.~Perry}) grāmatas%
	\cite{Perry-VHDL} piedāvāto procesora reali\-zā\-ciju, 
	bet ar ievērojamām izmaiņām, galvenokārt, pilnībā no jauna izstrādāta 
	instrukciju kopa un vienvirziena,
	cirkulāra datu apmaiņas šina, atšķirībā no kopējas,
	trīs\-stāvokļu arbitējamas datu šinas.
	Galvenais šādas uzbūves datu šinas realizācijas iemesls
	ir izmantojamās \termEn{Actel} FPGA darba platformas trīs\-stāvokļu
	loģikas atbalsta \mbox{trūkums.\cite[18.~lpp.]{FusionFAQ}}
	
	Kodola saskarne ar pārējām mikrokontroliera komponentēm ir izveidota
	pēc iespējas vienkāršāka un platformas neatkarīga, lai nebūtu nepieciešams
	veikt izmaiņas kodola uzbūvē izmantojot to dažādās mikrokontroliera
	implementācijās, t.i.~kodola datu apmaiņa notiek izmantojot
	asinhronu atmiņas (RAM)	saskarni. Ar dažādām ierīcēm iespējama
	komunikācija iespējama, ja tiek izmantota saskarnes komponente, kas
	emulē RAM un multipleksē perifērās iekārtas pēc nododamās adreses.
	Tādējādi kodols	ir praktiski neatkarīgs no pārējās 
	mikrokontroliera implementācijas.
	Šī īpašība izmantota mikrokontroliera paraugimplementācijā.
	(sk.~\ref{sec:design}~un \ref{sec:mmu}~nod.)
	% TODO: 
	
	Instruckiju kopa ir izstrādāta no jauna un piedāvā vienkāršotu
	kopu līdzīgi RISC (\termEn{Reduced Instruction Set Computing})
	filo\-so\-fijai. Salīdzinot ar Perija realizāciju, ievērojami samazinātas
	nosacījuma zarošanās instrukcijas un instrukcijas pieejamie 16 biti
	tiek efektīvāk izmantoti ieviešot vektorizētus jeb dažāda garuma
	operāciju kodus. (detalizētākam aprakstam sk.~\ref{sec:instrSet}~nod.)
	
	
	%Tā kā \termEn{Actel} FPGA risinājums neatbalsta trīs stāvokļu
	%loģiku\cite[18.~lpp.]{FusionFAQ},
	%tad kopēju iekšējo datu šinu nav iespējams
	%izveidot. Tā vietā izveidota vienvirziena, nosacīti cirkulāra datu
	%apmaiņas līnija. Datu līnijas sazarojumi dažādu komponenšu 
	%komunikācijai realizēti ar multipleksoru palīdzību.
	
	%\begin{figure}[bhp]
	%	\centering
	%	\def\svgwidth{\textwidth}
	%	{\ttfamily\scriptsize\input{img/control.pdf_tex}}
	%	\caption{Procesora kontrole un atmiņas saskarne.}
	%	\label{fig:controlPipeline}
	%\end{figure}
	%
	%\begin{figure}[thp]
	%	\centering
	%	\def\svgwidth{\textwidth}
	%	{\ttfamily\footnotesize\input{img/aluPipeline.pdf_tex}}
	%	\caption{Aritmētikas un loģikas signālceļš un uzbūve.}
	%	\label{fig:aluPipeline}
	%\end{figure}
	
	\begin{figure}[thb]
		\centering
		\def\svgwidth{\textwidth}
		{\ttfamily\footnotesize\input{img/top-rev3-detail.pdf_tex}}
		\caption{Kodola uzbūve.}
		\label{fig:cpu-rev3}
	\end{figure}
	
	%\pagebreak[4]
	%\clearpage
	% TODO: Atmiņas izdalījums, 'von Neumann bottleneck' un kā DMA palīdz
	\input{core.databus.tex} %\clearpage 
	%\input{core.cpulib.tex}	\clearpage
	\input{core.components.tex} \pagebreak[3]
	\input{core.instructions.tex} %\clearpage %\pagebreak[3]
	% Man vajag revīziju cēsturi?
	%\input{core.revisions.tex} %\pagebreak[3]
	
	% TODO?: Programmskaitītāja lokācija un PIC kods
